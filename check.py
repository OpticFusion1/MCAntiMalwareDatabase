#!#/usr/bin/env python3
# Checks malware checksums against the DB to find any that aren't in the database
#
# Author: Optic_Fusion1
# Date: 5/14/2021

import os
import sqlite3
import hashlib
import sys

conn = sqlite3.connect("database.db")
cursor = conn.cursor()
output = open('output.txt', 'a')

for file in os.listdir("malware"):
    file_path = os.path.join('malware', os.fsdecode(file))
    with open(file_path, 'rb') as f:
        checksum = hashlib.sha1()
        while chunk := f.read(8102):
            checksum.update(chunk)
        checksum = checksum.hexdigest().upper()
        cursor.execute('SELECT * FROM BlacklistedChecksums WHERE Checksum=?', (checksum,))
        row = cursor.fetchone()
        if row is None:
            print(checksum +  " is not in the database Path: " + file_path)